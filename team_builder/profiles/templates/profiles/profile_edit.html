<!--
MIT License

Copyright (c) 2018 Taranjeet Singh

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
-->

<!-- This template has been built in part with the help of the
django-library-app found here

https://github.com/taranjeet/django-library-app

The source code has been edited in order to work with this project -->


{% extends "nav_bar.html" %}

{% block title_tag %}Team Builder | profile{% endblock %}

{% block nav_bar %}

  <form method="post" enctype="multipart/form-data" action="">
    {% csrf_token %}

      {{ profile_form.honey_pot }}

    <div class="bounds circle--page">
      <div class="circle--page--header circle--fluid">
        <div class="circle--fluid--cell circle--fluid--primary">
          <h2>Profile</h2>
        </div>
        <div class="circle--fluid--cell circle--fluid--secondary">
          <button type="submit" class="button button-primary icon-on-left">
              Save Changes
          </button>
        </div>
      </div>

      <div class="grid-70">
        <p>Username</p>
          {{ profile_form.username.errors }}
        {{ profile_form.username }}
        <p>Website color</p>
          {{ profile_form.color }}
        <div class="circle--article--body">
          <p>Bio (markdown preview bellow)</p>
          {{ profile_form.bio }}
        </div>

        <h2>Past Projects</h2>
        <table class="u-full-width circle--table">
          <thead>
            <tr>
              <th>Project Title</th>
              <th class="circle--cell--right">Project Needs</th>
            </tr>
          </thead>
          <tbody>
            <tr class="clickable-row" data-href="project.html">
              <td>
                <h3>Invoice Delivery Tool</h3>
              </td>
              <td class="circle--cell--right">
                <span class="secondary-label">Rails Developer</span>
              </td>
            </tr>
            <tr class="clickable-row" data-href="project.html">
              <td>
                <h3>Twitter Client</h3>
              </td>
              <td class="circle--cell--right">
                <span class="secondary-label">Designer</span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="grid-25 grid-push-5">

        <div class="circle--secondary--module">
          <div class="circle--primary--avatar">
            <a class="button">
              Upload Photo
              {{ profile_form.avatar }}
            </a>
          </div>
        </div>

        <div class="circle--secondary--module">
          <h4>My Skills</h4>



<form class="form-horizontal" method="POST" action="">
    {% csrf_token %}
{{ skills_form.management_form }}
{% for form in skills_form %}
<div class="row form-row spacer">
    <div class="col-2">
        <label>{{form.skills.label}}</label>
    </div>
    <div class="col-4">
        <div class="input-group">
            {{form.skills}}
            <div class="input-group-append">
                <button class="btn btn-success add-form-row">+</button>
            </div>
        </div>
    </div>
</div>
{% endfor %}


{% block custom_js %}
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script type="text/javascript">
function updateElementIndex(el, prefix, ndx) {
    let id_regex = new RegExp('(' + prefix + '-\\d+)');
    let replacement = prefix + '-' + ndx;
    if ($(el).attr("for")) $(el).attr("for", $(el).attr("for").replace(id_regex, replacement));
    if (el.id) el.id = el.id.replace(id_regex, replacement);
    if (el.name) el.name = el.name.replace(id_regex, replacement);
}
function cloneMore(selector, prefix) {
    let newElement = $(selector).clone(true);
    let total = $('#id_' + prefix + '-TOTAL_FORMS').val();
    newElement.find(':input').each(function() {
        let name = $(this).attr('name')
        if(name) {
            name = name.replace('-' + (total-1) + '-', '-' + total + '-');
            let id = 'id_' + name;
            $(this).attr({'name': name, 'id': id}).val('').removeAttr('checked');
        }
    });
    total++;
    $('#id_' + prefix + '-TOTAL_FORMS').val(total);
    $(selector).after(newElement);
    let conditionRow = $('.form-row:not(:last)');
    conditionRow.find('.btn.add-form-row')
    .removeClass('btn-success').addClass('btn-danger')
    .removeClass('add-form-row').addClass('remove-form-row')
    .html('-');
    return false;
}
function deleteForm(prefix, btn) {
    let total = parseInt($('#id_' + prefix + '-TOTAL_FORMS').val());
    if (total > 1){
        btn.closest('.form-row').remove();
        let forms = $('.form-row');
        $('#id_' + prefix + '-TOTAL_FORMS').val(forms.length);
        for (let i=0, formCount=forms.length; i<formCount; i++) {
            $(forms.get(i)).find(':input').each(function() {
                updateElementIndex(this, prefix, i);
            });
        }
    }
    return false;
}
$(document).on('click', '.add-form-row', function(e){
    e.preventDefault();
    cloneMore('.form-row:last', 'form');
    return false;
});
$(document).on('click', '.remove-form-row', function(e){
    e.preventDefault();
    deleteForm('form', $(this));
    return false;
});

$( document ).ready(function() {
    // find all form add buttons on page load
    let found_forms = document.getElementsByClassName('btn btn-success add-form-row')

    let length = found_forms.length

    // If length is one we need to click and unclick the form, becuase no
    // data is in it. We don't want two empty forms
    if (length === '1') {
        // This gets the first form element and clicks it
        found_forms[0].click()
    }
    else {
        // This gets the first form element and clicks it
        found_forms[0].click()

        // Get the last form
        let found_deletes = document.getElementsByClassName('btn btn-danger remove-form-row')

        let delete_length = found_deletes.length
        let last_delete = found_deletes[delete_length]

        // Click the last form, so the user has all the proper buttons
        last_delete.click()
    }


    

});

</script>
{% endblock %}


        </div>

        <div class="circle--secondary--module">
          <h4>My Projects</h4>
          <ul class="circle--clone--list">
            <li>
              <input type="text" placeholder="Project Name" />
              <input type="text" placeholder="Project URL" />
              <a class="circle--clone--add">Add Project</a>
              <a class="circle--clone--remove">Remove</a>
            </li>
          </ul>
        </div>
      </div>
    </div>

  </form>

{{ profile_form.media }}

{% endblock nav_bar %}
